#
# Makefile template for build and
# installation of the C library.
#
# Maciej Bak
# Swiss Institute of Bioinformatics
# 15.07.2019
#

CC = gcc
CFLAGS = -O2
SRC = numDeriv.c
HDR = $(SRC:.c=.h)
OBJ = $(SRC:.c=.o)
LIB = $(OBJ:.o=.a)

.PHONY: all install clean uninstall

# =========================================================
# Build
# =========================================================

all: $(LIB)

# Create an object file
$(OBJ):
	$(CC) $(CFLAGS) -c -o $@ $(SRC)

# Create a static library file
$(LIB): $(OBJ)
	ar rcs $@ $<

# =========================================================
# Install
# =========================================================

install: {LIB_DIR}/$(LIB) {LIB_DIR}/$(HDR)

# Create top-level directory for the library
{LIB_DIR}:
	mkdir -p $@

# Copy the library file into the directory
{LIB_DIR}/$(LIB): $(LIB) {LIB_DIR}
	cp $< $@

# Copy the header file into the directory
{LIB_DIR}/$(HDR): $(HDR) {LIB_DIR}
	cp $< $@

# =========================================================
# Clean
# =========================================================

# Remove the build files
clean:
	rm -f $(OBJ);
	rm -f $(LIB);

# =========================================================
# Uninstall
# =========================================================

# Remove the top-level static library
uninstall:
	rm -f {LIB_DIR}/$(LIB);
	rm -f {LIB_DIR}/$(HDR);
	if [ $$(ls -a1 {LIB_DIR} | wc -l) == 2 ]; then \
		rm -rf {LIB_DIR}; \
	fi
